-- ============================= CREACION DEL ESQUEMA DE LA BASE DE DATOS ====================
-- ============================= TABLES (28) =======================
CREATE TABLE EVENTO_SINCRONIZACION (
	FECHA_EVENTO		TIMESTAMP	 NOT NULL ,
	TIPO_EVENTO		INTEGER	 NOT NULL ,
	AFECTACION_GLOBAL		INTEGER	 NOT NULL ,
	SUCURSAL_ID_AFECTADA		INTEGER	 NOT NULL ,
	TABLA		VARCHAR (64)	 NOT NULL ,
	CAMPOS_LLAVE		VARCHAR (64)	 NOT NULL ,
	VALORES_LLAVE		VARCHAR (128)	 NOT NULL ,
	PRIMARY KEY (FECHA_EVENTO)
);
-- ===============================================================================
CREATE TABLE CFD_VENTA (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	ULTIMA_ACTUALIZACION		TIMESTAMP	 NOT NULL ,
	CONTENIDO_ORIGINAL_XML		BLOB	 ,
	CALLING_ERROR_RESULT		VARCHAR (1024)	 ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE MULTIMEDIO (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	MIME_TYPE		VARCHAR (64)	 NOT NULL ,
	RUTA_CONTENIDO		VARCHAR (512)	 NOT NULL ,
	SIZE_BYTES		INTEGER	 NOT NULL ,
	NOMBRE_ARCHIVO		VARCHAR (255)	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE LINEA (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	NOMBRE		VARCHAR (128)	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE METODO_DE_PAGO (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	DESCRIPCION		VARCHAR (255)	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE PERFIL (
	ID		VARCHAR (32)	 NOT NULL ,
	DESCRIPCION		VARCHAR (32)	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE FORMA_DE_PAGO (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	DESCRIPCION		VARCHAR (255)	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE CLIENTE (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	RFC		VARCHAR (16)	 NOT NULL ,
	RAZON_SOCIAL		VARCHAR (128)	 NOT NULL ,
	NOMBRE_ESTABLECIMIENTO		VARCHAR (128)	 ,
	CONTACTO		VARCHAR (128)	 ,
	TELEFONOS		VARCHAR (128)	 ,
	EMAIL		VARCHAR (64)	 ,
	OBSERVACIONES		VARCHAR (255)	 ,
	DIRECCION		VARCHAR (255)	 ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE CONFIGURACION_SISTEMA (
	LLAVE		VARCHAR (128)	 NOT NULL ,
	VALOR		VARCHAR (255)	 NOT NULL ,
	PRIMARY KEY (LLAVE)
);
-- ===============================================================================
CREATE TABLE INDUSTRIA (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	NOMBRE		VARCHAR (128)	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE LINEA_MULTIMEDIO (
	LINEA_ID		INTEGER	 NOT NULL ,
	MULTIMEDIO_ID		INTEGER	 NOT NULL ,
	PRIMARY KEY (LINEA_ID, MULTIMEDIO_ID)
);
-- ===============================================================================
CREATE TABLE ALMACEN (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	SUCURSAL_ID		INTEGER	 NOT NULL ,
	TIPO_ALMACEN		INTEGER	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE USUARIO_PERFIL (
	EMAIL		VARCHAR (64)	 NOT NULL ,
	PERFIL_ID		VARCHAR (32)	 NOT NULL ,
	PRIMARY KEY (EMAIL, PERFIL_ID)
);
-- ===============================================================================
CREATE TABLE PRODUCTO (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	CODIGO_BARRAS		VARCHAR (64)	 NOT NULL ,
	MARCA_ID		INTEGER	 NOT NULL ,
	NOMBRE		VARCHAR (255)	 NOT NULL ,
	PRESENTACION		VARCHAR (255)	 NOT NULL ,
	UNIDADES_POR_CAJA		INTEGER	 NOT NULL ,
	UNIDAD_MEDIDA		VARCHAR (8)	 NOT NULL ,
	COSTO		DOUBLE	 NOT NULL ,
	COSTO_VENTA		DOUBLE	 NOT NULL ,
	CONTENIDO		VARCHAR (16)	 ,
	ABREBIATURA		VARCHAR (128)	 ,
	PRECIO_VENTA_TMP		DOUBLE	 ,
	CANTIDAD_ACTUAL_TMP		INTEGER	 ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE USUARIO (
	EMAIL		VARCHAR (64)	 NOT NULL ,
	HABILITADO		INTEGER	 NOT NULL ,
	NOMBRE_COMPLETO		VARCHAR (128)	 NOT NULL ,
	PASSWORD		VARCHAR (64)	 NOT NULL ,
	SUCURSAL_ID		INTEGER	 ,
	PRIMARY KEY (EMAIL)
);
-- ===============================================================================
CREATE TABLE INDUSTRIA_MULTIMEDIO (
	INDUSTRIA_ID		INTEGER	 NOT NULL ,
	MULTIMEDIO_ID		INTEGER	 NOT NULL ,
	PRIMARY KEY (INDUSTRIA_ID, MULTIMEDIO_ID)
);
-- ===============================================================================
CREATE TABLE MOVIMIENTO_OPERATIVO_ALMACEN (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	MOTIVO		VARCHAR (255)	 NOT NULL ,
	USUARIO_EMAIL		VARCHAR (64)	 NOT NULL ,
	FECHA_INICIO		TIMESTAMP	 NOT NULL ,
	ALMACEN_ORIGEN		INTEGER	 NOT NULL ,
	ALMACEN_DESTINO		INTEGER	 NOT NULL ,
	TIPO_MOVIMIENTO_ID		INTEGER	 NOT NULL ,
	FECHA_CONFIRMACION		INTEGER	 ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE MARCA_MULTIMEDIO (
	MARCA_ID		INTEGER	 NOT NULL ,
	MULTIMEDIO_ID		INTEGER	 NOT NULL ,
	PRIMARY KEY (MARCA_ID, MULTIMEDIO_ID)
);
-- ===============================================================================
CREATE TABLE MOVIMIENTO_HISTORICO_PRODUCTO (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	ALMACEN_ID		INTEGER	 NOT NULL ,
	PRODUCTO_ID		INTEGER	 NOT NULL ,
	FECHA		TIMESTAMP	 NOT NULL ,
	TIPO_MOVIMIENTO		INTEGER	 NOT NULL ,
	CANTIDAD		INTEGER	 NOT NULL ,
	COSTO		DOUBLE	 ,
	PRECIO		DOUBLE	 ,
	USUARIO_EMAIL		VARCHAR (64)	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE ENTRADA_ALMACEN (
	ID		INTEGER	 NOT NULL ,
	ALMACEN_ID		INTEGER	 NOT NULL ,
	USUARIO_EMAIL		VARCHAR (64)	 NOT NULL ,
	FECHA		TIMESTAMP	 NOT NULL ,
	COMENTARIOS		VARCHAR (255)	 ,
	DESCUENTO_APLICADO		DOUBLE	 ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE PRODUCTO_MULTIMEDIO (
	PRODUCTO_ID		INTEGER	 NOT NULL ,
	MULTIMEDIO_ID		INTEGER	 NOT NULL ,
	PRIMARY KEY (PRODUCTO_ID, MULTIMEDIO_ID)
);
-- ===============================================================================
CREATE TABLE MARCA (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	INDUSTRIA_ID		INTEGER	 NOT NULL ,
	LINEA_ID		INTEGER	 NOT NULL ,
	NOMBRE		VARCHAR (64)	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE MOVIMIENTO_OPERATIVO_ALMACEN_DETALLE (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	MOVIMIENTO_OPERATIVO_ALMACEN_ID		INTEGER	 NOT NULL ,
	PRODUCTO_ID		INTEGER	 NOT NULL ,
	CANTIDAD		INTEGER	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE ALMACEN_PRODUCTO (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	ALMACEN_ID		INTEGER	 NOT NULL ,
	PRODUCTO_ID		INTEGER	 NOT NULL ,
	CANTIDAD_ACTUAL		INTEGER	 NOT NULL ,
	PRECIO_VENTA		DOUBLE	 NOT NULL ,
	PRECIO_MAYOREO		DOUBLE	 NOT NULL ,
	COSTO		DOUBLE	 ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE PEDIDO_VENTA_DETALLE (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	PEDIDO_VENTA_ID		INTEGER	 NOT NULL ,
	ALMACEN_ID		INTEGER	 NOT NULL ,
	PRODUCTO_ID		INTEGER	 NOT NULL ,
	CANTIDAD		INTEGER	 NOT NULL ,
	PRECIO_VENTA		DOUBLE	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE PEDIDO_VENTA (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	ESTADO		INTEGER	 NOT NULL ,
	FECHA_ACTUALIZACION		TIMESTAMP	 NOT NULL ,
	USUARIO_EMAIL		VARCHAR (64)	 NOT NULL ,
	CLIENTE_ID		INTEGER	 ,
	FORMA_DE_PAGO_ID		INTEGER	 ,
	METODO_DE_PAGO_ID		INTEGER	 ,
	FACTORIVA		DOUBLE	 NOT NULL ,
	COMENTARIOS		VARCHAR (255)	 ,
	DESCUENTO_APLICADO		DOUBLE	 ,
	FACTURABLE		INTEGER	 ,
	CFD_VENTA_ID		INTEGER	 ,
	NUMERO_TICKET		VARCHAR (128)	 ,
	CAJA		INTEGER	 ,
	IMPORTE_RECIBIDO		DOUBLE	 ,
	APROBACION_VISA_MASTERCARD		VARCHAR (64)	 ,
	MAYOREO		INTEGER	 ,
	PORCENTAJE_DESCUENTO_CALCULADO		INTEGER	 ,
	PORCENTAJE_DESCUENTO_EXTRA		INTEGER	 ,
	CONDICIONES_DE_PAGO		VARCHAR (128)	 ,
	NUM_DE_CUENTA		VARCHAR (32)	 ,
	MOTIVO_DESCUENTO		VARCHAR (128)	 ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE ENTRADA_ALMACEN_DETALLE (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	ENTRADA_ALMACEN_ID		INTEGER	 NOT NULL ,
	PRODUCTO_ID		INTEGER	 NOT NULL ,
	CANTIDAD		INTEGER	 NOT NULL ,
	PRECIO_VENTA		DOUBLE	 NOT NULL ,
	COSTO		DOUBLE	 NOT NULL ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
CREATE TABLE SUCURSAL (
	ID		INTEGER	 NOT NULL GENERATED BY DEFAULT AS IDENTITY ,
	ID_PADRE		INTEGER	 ,
	NOMBRE		VARCHAR (128)	 NOT NULL ,
	DIRECCION		VARCHAR (255)	 ,
	TELEFONOS		VARCHAR (128)	 ,
	USUARIO_SICOFI		VARCHAR (64)	 ,
	PASSWORD_SICOFI		VARCHAR (64)	 ,
	SERIE_SICOFI		VARCHAR (4)	 ,
	COMENTARIOS		VARCHAR (255)	 ,
	DESCUENTO_MAYOREO_HABILITADO		INTEGER	 ,
	PRIMARY KEY (ID)
);
-- ===============================================================================
-- =================================== CONSTRAINTS ==============================
ALTER TABLE LINEA_MULTIMEDIO ADD FOREIGN KEY (LINEA_ID)	REFERENCES LINEA(ID);
ALTER TABLE LINEA_MULTIMEDIO ADD FOREIGN KEY (MULTIMEDIO_ID)	REFERENCES MULTIMEDIO(ID);
ALTER TABLE ALMACEN ADD FOREIGN KEY (SUCURSAL_ID)	REFERENCES SUCURSAL(ID);
ALTER TABLE USUARIO_PERFIL ADD FOREIGN KEY (EMAIL)	REFERENCES USUARIO(EMAIL);
ALTER TABLE USUARIO_PERFIL ADD FOREIGN KEY (PERFIL_ID)	REFERENCES PERFIL(ID);
ALTER TABLE PRODUCTO ADD FOREIGN KEY (MARCA_ID)	REFERENCES MARCA(ID);
ALTER TABLE USUARIO ADD FOREIGN KEY (SUCURSAL_ID)	REFERENCES SUCURSAL(ID);
ALTER TABLE INDUSTRIA_MULTIMEDIO ADD FOREIGN KEY (INDUSTRIA_ID)	REFERENCES INDUSTRIA(ID);
ALTER TABLE INDUSTRIA_MULTIMEDIO ADD FOREIGN KEY (MULTIMEDIO_ID)	REFERENCES MULTIMEDIO(ID);
ALTER TABLE MOVIMIENTO_OPERATIVO_ALMACEN ADD FOREIGN KEY (USUARIO_EMAIL)	REFERENCES USUARIO(EMAIL);
ALTER TABLE MOVIMIENTO_OPERATIVO_ALMACEN ADD FOREIGN KEY (ALMACEN_ORIGEN)	REFERENCES ALMACEN(ID);
ALTER TABLE MOVIMIENTO_OPERATIVO_ALMACEN ADD FOREIGN KEY (ALMACEN_DESTINO)	REFERENCES ALMACEN(ID);
ALTER TABLE MARCA_MULTIMEDIO ADD FOREIGN KEY (MARCA_ID)	REFERENCES MARCA(ID);
ALTER TABLE MARCA_MULTIMEDIO ADD FOREIGN KEY (MULTIMEDIO_ID)	REFERENCES MULTIMEDIO(ID);
ALTER TABLE MOVIMIENTO_HISTORICO_PRODUCTO ADD FOREIGN KEY (ALMACEN_ID)	REFERENCES ALMACEN(ID);
ALTER TABLE MOVIMIENTO_HISTORICO_PRODUCTO ADD FOREIGN KEY (PRODUCTO_ID)	REFERENCES PRODUCTO(ID);
ALTER TABLE MOVIMIENTO_HISTORICO_PRODUCTO ADD FOREIGN KEY (USUARIO_EMAIL)	REFERENCES USUARIO(EMAIL);
ALTER TABLE ENTRADA_ALMACEN ADD FOREIGN KEY (ALMACEN_ID)	REFERENCES ALMACEN(ID);
ALTER TABLE ENTRADA_ALMACEN ADD FOREIGN KEY (USUARIO_EMAIL)	REFERENCES USUARIO(EMAIL);
ALTER TABLE PRODUCTO_MULTIMEDIO ADD FOREIGN KEY (PRODUCTO_ID)	REFERENCES PRODUCTO(ID);
ALTER TABLE PRODUCTO_MULTIMEDIO ADD FOREIGN KEY (MULTIMEDIO_ID)	REFERENCES MULTIMEDIO(ID);
ALTER TABLE MARCA ADD FOREIGN KEY (INDUSTRIA_ID)	REFERENCES INDUSTRIA(ID);
ALTER TABLE MARCA ADD FOREIGN KEY (LINEA_ID)	REFERENCES LINEA(ID);
ALTER TABLE MOVIMIENTO_OPERATIVO_ALMACEN_DETALLE ADD FOREIGN KEY (MOVIMIENTO_OPERATIVO_ALMACEN_ID)	REFERENCES MOVIMIENTO_OPERATIVO_ALMACEN(ID);
ALTER TABLE MOVIMIENTO_OPERATIVO_ALMACEN_DETALLE ADD FOREIGN KEY (PRODUCTO_ID)	REFERENCES PRODUCTO(ID);
ALTER TABLE ALMACEN_PRODUCTO ADD FOREIGN KEY (ALMACEN_ID)	REFERENCES ALMACEN(ID);
ALTER TABLE ALMACEN_PRODUCTO ADD FOREIGN KEY (PRODUCTO_ID)	REFERENCES PRODUCTO(ID);
ALTER TABLE PEDIDO_VENTA_DETALLE ADD FOREIGN KEY (PEDIDO_VENTA_ID)	REFERENCES PEDIDO_VENTA(ID);
ALTER TABLE PEDIDO_VENTA_DETALLE ADD FOREIGN KEY (ALMACEN_ID)	REFERENCES ALMACEN(ID);
ALTER TABLE PEDIDO_VENTA_DETALLE ADD FOREIGN KEY (PRODUCTO_ID)	REFERENCES PRODUCTO(ID);
ALTER TABLE PEDIDO_VENTA ADD FOREIGN KEY (USUARIO_EMAIL)	REFERENCES USUARIO(EMAIL);
ALTER TABLE PEDIDO_VENTA ADD FOREIGN KEY (CLIENTE_ID)	REFERENCES CLIENTE(ID);
ALTER TABLE PEDIDO_VENTA ADD FOREIGN KEY (FORMA_DE_PAGO_ID)	REFERENCES FORMA_DE_PAGO(ID);
ALTER TABLE PEDIDO_VENTA ADD FOREIGN KEY (METODO_DE_PAGO_ID)	REFERENCES METODO_DE_PAGO(ID);
ALTER TABLE PEDIDO_VENTA ADD FOREIGN KEY (CFD_VENTA_ID)	REFERENCES CFD_VENTA(ID);
ALTER TABLE ENTRADA_ALMACEN_DETALLE ADD FOREIGN KEY (ENTRADA_ALMACEN_ID)	REFERENCES ENTRADA_ALMACEN(ID);
ALTER TABLE ENTRADA_ALMACEN_DETALLE ADD FOREIGN KEY (PRODUCTO_ID)	REFERENCES PRODUCTO(ID);
ALTER TABLE SUCURSAL ADD FOREIGN KEY (ID_PADRE)	REFERENCES SUCURSAL(ID);
